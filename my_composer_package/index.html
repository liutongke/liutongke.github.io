<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>开发一个属于自己的第一个Composer/Packagist包 | keke的个人博客</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="开发一个属于自己的第一个Composer/Packagist包">
<meta name="keywords" content="php, composer, github" >


  <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'your-google-analytics-id', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<meta name="referrer" content="no-referrer-when-downgrade">

  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>首页</a>
	
	<a href="/posts">归档</a>
	<a href="/tags">标签</a>
	<a href="/about">关于</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">开发一个属于自己的第一个Composer/Packagist包</h1>

    <div class="tip">
        <time datetime="2018-04-03 00:00:00 &#43;0000 UTC">2018年04月03日</time>
        <span class="split">
          ·
        </span>
        <span>
          1228字
        </span>
        <span class="split">
          ·
        </span>
        <span>
          3分钟
        </span>
        <span class="split">
          ·
        </span>
        <span>
          <span id="busuanzi_container_page_pv">阅读量<span id="busuanzi_value_page_pv"></span>次</span>
        </span>
    </div>

    
    
        
  


    


    <div class="content">
      <p>Composer 给我们带来了诸多的好处：</p>
<ul>
<li>模块化，降低代码重用成本</li>
<li>统一的第三方代码组织方式</li>
<li>更科学的版本更新
　　</li>
</ul>
<p><strong>初始化项目，生成composer.json文件</strong>
初始实例项目代码目录结构：
<p class="markdown-image">
  <img src="https://image-hosting-services.oss-cn-hangzhou.aliyuncs.com/1151613-20180413102555659-1570873119.png" alt=""  />
</p>
现在要在项目的根目录里通过<code>composer init</code>命令创建一个<code>composer.json</code>的文件，也可以手动创建：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>composer init
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Welcome to the Composer config generator
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This <span style="color:#a2f">command</span> will guide you through creating your composer.json config.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Package name <span style="color:#666">(</span>&lt;vendor&gt;/&lt;name&gt;<span style="color:#666">)</span> <span style="color:#666">[</span>administrator/mobile-push<span style="color:#666">]</span>: keke/hello
</span></span><span style="display:flex;"><span>Description <span style="color:#666">[]</span>: this is example
</span></span><span style="display:flex;"><span>Author <span style="color:#666">[</span>keke &lt;liutongke@live.com&gt;, n to skip<span style="color:#666">]</span>:
</span></span><span style="display:flex;"><span>Minimum Stability <span style="color:#666">[]</span>: dev
</span></span><span style="display:flex;"><span>Package Type <span style="color:#666">(</span>e.g. library, project, metapackage, composer-plugin<span style="color:#666">)</span> <span style="color:#666">[]</span>:
</span></span><span style="display:flex;"><span>License <span style="color:#666">[]</span>: MIT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Define your dependencies.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Would you like to define your dependencies <span style="color:#666">(</span>require<span style="color:#666">)</span> interactively <span style="color:#666">[</span>yes<span style="color:#666">]</span>?
</span></span><span style="display:flex;"><span>Search <span style="color:#a2f;font-weight:bold">for</span> a package:
</span></span><span style="display:flex;"><span>Would you like to define your dev dependencies <span style="color:#666">(</span>require-dev<span style="color:#666">)</span> interactively <span style="color:#666">[</span>yes<span style="color:#666">]</span>?
</span></span><span style="display:flex;"><span>Search <span style="color:#a2f;font-weight:bold">for</span> a package:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b44">&#34;name&#34;</span>: <span style="color:#b44">&#34;keke/hello&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#b44">&#34;description&#34;</span>: <span style="color:#b44">&#34;this is example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#b44">&#34;license&#34;</span>: <span style="color:#b44">&#34;MIT&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#b44">&#34;authors&#34;</span>: <span style="color:#666">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#b44">&#34;name&#34;</span>: <span style="color:#b44">&#34;keke&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#b44">&#34;email&#34;</span>: <span style="color:#b44">&#34;liutongke@live.com&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#666">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">]</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#b44">&#34;minimum-stability&#34;</span>: <span style="color:#b44">&#34;dev&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#b44">&#34;require&#34;</span>: <span style="color:#666">{}</span>
</span></span><span style="display:flex;"><span><span style="color:#666">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you confirm generation <span style="color:#666">[</span>yes<span style="color:#666">]</span>?
</span></span></code></pre></div><p>重要的几个填写项：</p>
<ol>
<li>Package name（重要）：包名，一般是公司名+&quot;/&quot;+包名 比如 baocai/yprint</li>
<li>Minimum Stability：通常默认填写dev，因为第一次代码Push完，是在dev-master分支上，dev也就是最小稳定版本标识号</li>
<li>Package Type：根据库类别填写，sdk，lib，都可以</li>
<li>License：版权，默认填写 MIT</li>
<li>接下来填写自身库需要的依赖，默认填no，后续可以在composer.json中补充修改</li>
</ol>
<p>根目录下就生成了composer.json文件，目录结构如下：</p>
<p><p class="markdown-image">
  <img src="https://image-hosting-services.oss-cn-hangzhou.aliyuncs.com/1151613-20180413102702921-1717348412.png" alt=""  />
</p></p>
<p><strong>添加自动加载</strong>
编辑生成的<code>composer.json</code>文件，添加php的版本要求和自动加载（使用PSR-4)，加载src目录下的所有文件,如下</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;name&#34;</span>: <span style="color:#b44">&#34;keke/hello&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;description&#34;</span>: <span style="color:#b44">&#34;this is example&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;license&#34;</span>: <span style="color:#b44">&#34;MIT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;authors&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#008000;font-weight:bold">&#34;name&#34;</span>: <span style="color:#b44">&#34;keke&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#008000;font-weight:bold">&#34;email&#34;</span>: <span style="color:#b44">&#34;liutongke@live.com&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;minimum-stability&#34;</span>: <span style="color:#b44">&#34;dev&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;require&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#008000;font-weight:bold">&#34;php&#34;</span>: <span style="color:#b44">&#34;&gt;=7.0.0&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#008000;font-weight:bold">&#34;autoload&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#008000;font-weight:bold">&#34;psr-4&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#008000;font-weight:bold">&#34;hello\\&#34;</span>: <span style="color:#b44">&#34;src/&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>进行测试
下面我们来简单测试下我们的类是否工作正常。我们在项目根目录执行<code>composer install</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Loading composer repositories with package information
</span></span><span style="display:flex;"><span>Updating dependencies <span style="color:#666">(</span>including require-dev<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>Nothing to install or update
</span></span><span style="display:flex;"><span>Writing lock file
</span></span><span style="display:flex;"><span>Generating autoload files
</span></span></code></pre></div><p>生成的目录结构：</p>
<p><p class="markdown-image">
  <img src="https://image-hosting-services.oss-cn-hangzhou.aliyuncs.com/1151613-20180413103030841-328195100.png" alt=""  />
</p></p>
<p>创建测试文件
下面我们在根目录下新建一个测试文件test.php</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">require_once</span> <span style="color:#800">__DIR__</span> <span style="color:#666">.</span> <span style="color:#b44">&#39;/vendor/autoload.php&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">use</span> hello\Hello;
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">echo</span> Hello<span style="color:#666">::</span><span style="color:#b44">world</span>();
</span></span></code></pre></div><p>执行成功出现hello world说明已经测试通过成功了，接下来就是将自己的第一个composer包发布到Packagist.org上了：</p>
<p><p class="markdown-image">
  <img src="https://image-hosting-services.oss-cn-hangzhou.aliyuncs.com/1151613-20180413103337949-1278397723.png" alt=""  />
</p></p>
<p>发布到Packagist.org
将第一步中生成的项目文件，提交到GitHub</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#b44">&#39;composer init&#39;</span>
</span></span><span style="display:flex;"><span>git push
</span></span></code></pre></div><p>　　</p>
<ol>
<li>提交到Packagist</li>
<li>首先要在Packagist上注册账号并登录</li>
<li>点击顶部导航条中的Summit按钮</li>
<li>在输入框中输入github上的仓库地址</li>
<li>然后点击Check按钮</li>
<li>Packagist会去检测此仓库地址的代码是否符合Composer的Package包的要求</li>
<li>检测正常的话，会出现Submit按钮，再点击一下Submit按钮，我们的包就提交到Packagist上了</li>
</ol>
<p><strong>验证包安装</strong>
以上步骤完成，就可以验证包是否能从库中查询到并且验证是否能够成功安装，特别注意，因为刚提交，还没有设置版本，此时版本默认是dev-master，如果直接require包名，会提示找不到对应版本，务必加上版本指定，这里是：dev-master</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="">composer</span> <span style="">require</span> <span style="">wangyi-live/netease</span> <span style="">dev-master</span>
</span></span></code></pre></div><p>直接require包名，提示找不到对应版本错误提示（解决办法设置版本号）：</p>
<p><p class="markdown-image">
  <img src="https://image-hosting-services.oss-cn-hangzhou.aliyuncs.com/1151613-20180413100545192-1264389311.png" alt=""  />
</p></p>
<p>设置版本
版本默认是dev-master，Composer包的版本号会从Git的tag中同步过来，因此先设置项目代码的tag，回到项目目录</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git tag 1.0.0
</span></span><span style="display:flex;"><span>git push --tag
</span></span></code></pre></div><p>　　　　</p>

    </div>

    
        <div class="tags">
            
                <a href="https://ltkblog.cn/tags/php">php</a>
            
                <a href="https://ltkblog.cn/tags/composer">composer</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/liutongke" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>


</div>

    

    <div class="copyright">
    
        Copyright © 2017-2022
    
    </div>

    
    
    <div class="busuanzi-footer">
  <span id="busuanzi_container_site_pv">
    总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
        <span id="busuanzi_container_site_uv">
    总访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
    </div>
    
</footer>



  </body>
</html>
